# 1.

```bash
sudo apt update && sudo apt install -y build-essential cmake git pkg-config patchelf '^libxcb.*-dev' libx11-xcb-dev libglu1-mesa-dev libxrender-dev libxi-dev libxkbcommon-dev libxkbcommon-x11-dev libegl1-mesa-dev mesa-common-dev libfontconfig1-dev libfreetype6-dev libharfbuzz-dev libdbus-1-dev libjpeg-dev libpng-dev libzstd-dev libssl-dev libpcre2-dev libdouble-conversion-dev libbrotli-dev libicu-dev libltdl-dev curl zip unzip tar nano ninja-build linux-libc-dev bison flex autoconf autoconf-archive automake libtool python3-pip python3-jinja2 libarchive-dev libwayland-dev nasm python3-venv xorg-dev
```

编译libmysql的时候补充的内容
sudo apt update && sudo apt install -y \
  build-essential cmake ninja-build \
  libssl-dev zlib1g-dev libncurses5-dev \
  libcurl4-openssl-dev liblz4-dev libzstd-dev \
  pkg-config libtirpc-dev

可能包没列全，需要自行补充一些内容
按照vcpkg的官方指南把vcpkg的环境配置好

# 2.

然后把./community目录下的*.cmake文件拷贝到系统vcpkg文件夹下的vcpkg/triplets/community/目录中

比如我的vcpkg安装路径在/opt/vcpkg/中

我的命令是

```bash
sudo cp ./community/microear* /opt/vcpkg/triplets/community/
```

# 3.

比如我想想编译x64 dynamic debug的版本
手动cmake配置的命令：`cmake --preset=microear-x64-linux-dynamic-debug`
手动cmake编译的命令是：`cmake --build --preset=microear-x64-linux-dynamic-debug`

手动编译的内容的动态链接指向都是系统绝对路径的库。

更简单的可以使用`build-microear.sh`来一次性构建x64或者arm64环境下的 `动态+静态 * debug+release`组合的内容了(会自动识别当前编译环境，只做了x64和arm64的适配)，一次性会把4种组合全部配置和编译出来。
亦可参考帮助文档编译指定内容。目前不支持交叉编译，所以在x64环境下指定编译arm64内容应该是无法通过的。

使用`build-microear.sh`会调用patchelf来修改程序的动态库调用路径为../lib/相对路径的库，方便打包到容器中。

```bash
dev@DESKTOP-CU9FES5:/mnt/e/ws_docker/helloworld$ ./build-microear.sh -h
Usage:
  ./build-microear.sh [--arch x64|arm64] [--link dynamic|static|all] [--config debug|release|all] [--dry-run] [-j N]
  例：
    ./build-microear.sh                               # 当前平台的 dynamic+static × debug+release 全部构建
    ./build-microear.sh --link dynamic --config debug # 只构建 dynamic+debug
    ./build-microear.sh --arch arm64 --link static    # ARM64 的 static × (debug+release)
    JOBS=8 ./build-microear.sh --link dynamic         # 指定并行度 8
    DRY_RUN=1 ./build-microear.sh --link static       # 仅打印将执行的命令
```



# 4.

执行`bundle-microear.sh`

```sh
# 自动扫描 ./build/microear-*-linux-* ，区分静态/动态，把可执行和依赖打到 ./install/<preset>/ 里，
# 并自动生成 Dockerfile + 构建/运行/检查脚本。
```

自动添加了那些脚本的可执行权限。
比如在helloworld/install/microear-x64-linux-dynamic-debug目录中的目录结构是：

```bash
dev@DESKTOP-CU9FES5:/mnt/e/ws_docker/helloworld$ tree -p -h -f --noreport ./install/microear-x64-linux-dynamic-debug
[drwxrwxrwx 4.0K]  ./install/microear-x64-linux-dynamic-debug
├── [-rwxrwxrwx  174]  ./install/microear-x64-linux-dynamic-debug/Dockerfile.scratch.universal
├── [drwxrwxrwx 4.0K]  ./install/microear-x64-linux-dynamic-debug/bin
│   └── [-rwxrwxrwx 2.0M]  ./install/microear-x64-linux-dynamic-debug/bin/HelloWorld
├── [-rwxrwxrwx  382]  ./install/microear-x64-linux-dynamic-debug/build-image.sh
├── [-rwxrwxrwx  302]  ./install/microear-x64-linux-dynamic-debug/ld-list.sh
├── [drwxrwxrwx 4.0K]  ./install/microear-x64-linux-dynamic-debug/lib
│   ├── [-rwxrwxrwx 235K]  ./install/microear-x64-linux-dynamic-debug/lib/ld-linux-x86-64.so.2
│   ├── [-rwxrwxrwx 2.2M]  ./install/microear-x64-linux-dynamic-debug/lib/libc.so.6
│   ├── [-rwxrwxrwx 670K]  ./install/microear-x64-linux-dynamic-debug/lib/libcserialport.so
│   ├── [lrwxrwxrwx   17]  ./install/microear-x64-linux-dynamic-debug/lib/libfmtd.so.11 -> libfmtd.so.11.2.0
│   ├── [-rwxrwxrwx 872K]  ./install/microear-x64-linux-dynamic-debug/lib/libfmtd.so.11.2.0
│   ├── [-rwxrwxrwx 128K]  ./install/microear-x64-linux-dynamic-debug/lib/libgcc_s.so.1
│   ├── [-rwxrwxrwx 940K]  ./install/microear-x64-linux-dynamic-debug/lib/libm.so.6
│   ├── [lrwxrwxrwx   19]  ./install/microear-x64-linux-dynamic-debug/lib/libstdc++.so.6 -> libstdc++.so.6.0.30
│   └── [-rwxrwxrwx 2.5M]  ./install/microear-x64-linux-dynamic-debug/lib/libstdc++.so.6.0.30
├── [-rwxrwxrwx  628]  ./install/microear-x64-linux-dynamic-debug/manifest.txt
└── [-rwxrwxrwx  250]  ./install/microear-x64-linux-dynamic-debug/run-image.sh
```

